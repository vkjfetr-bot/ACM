# Grafana Dashboard Development - Complete Skill Reference

## Skill Metadata
- **Skill Name**: grafana-dashboard-master
- **Version**: 1.0.0
- **Last Updated**: 2026-01-17
- **Applicable Grafana Versions**: 10.x, 11.x
- **Primary Focus**: Dashboard JSON creation, visualization configuration, SQL datasource queries

---

## 1. Dashboard JSON Model Structure

### 1.1 Complete Dashboard JSON Schema

```json
{
  "id": null,
  "uid": "unique-dashboard-id",
  "title": "Dashboard Title",
  "description": "Dashboard description",
  "tags": ["tag1", "tag2"],
  "timezone": "browser",
  "editable": true,
  "graphTooltip": 0,
  "panels": [],
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"],
    "hidden": false
  },
  "templating": {
    "list": []
  },
  "annotations": {
    "list": []
  },
  "refresh": "5s",
  "schemaVersion": 40,
  "version": 1,
  "links": [],
  "fiscalYearStartMonth": 0,
  "liveNow": false,
  "weekStart": ""
}
```

### 1.2 Dashboard-Level Field Reference

| Field | Type | Description |
|-------|------|-------------|
| `id` | number/null | Unique numeric ID (auto-generated by DB) |
| `uid` | string | Unique identifier (8-40 chars, user-definable) |
| `title` | string | Dashboard display title |
| `description` | string | Optional dashboard description |
| `tags` | string[] | Array of tags for organization |
| `timezone` | string | `"browser"`, `"utc"`, or specific timezone |
| `editable` | boolean | Whether dashboard can be edited |
| `graphTooltip` | number | 0=none, 1=shared crosshair, 2=shared crosshair+tooltip |
| `time` | object | Default time range (`from`, `to`) |
| `refresh` | string | Auto-refresh interval (e.g., "5s", "1m", "5m") |
| `schemaVersion` | number | JSON schema version (current: 40) |
| `version` | number | Dashboard version (increment on save) |

### 1.3 Time Range Syntax

```json
"time": {
  "from": "now-6h",    // Relative: now-Xm, now-Xh, now-Xd, now-Xw, now-XM, now-Xy
  "to": "now"          // Absolute: "2024-01-01T00:00:00.000Z"
}
```

**Common Relative Patterns:**
- `now-5m` - Last 5 minutes
- `now-1h` - Last 1 hour
- `now-24h` - Last 24 hours
- `now-7d` - Last 7 days
- `now-30d` - Last 30 days
- `now-1y` - Last 1 year
- `now/d` - Start of today
- `now/w` - Start of this week
- `now/M` - Start of this month

---

## 2. Panel Structure

### 2.1 Complete Panel JSON Schema

```json
{
  "id": 1,
  "type": "timeseries",
  "title": "Panel Title",
  "description": "Panel description",
  "transparent": false,
  "datasource": {
    "type": "mssql",
    "uid": "${datasource}"
  },
  "gridPos": {
    "x": 0,
    "y": 0,
    "w": 12,
    "h": 8
  },
  "targets": [],
  "options": {},
  "fieldConfig": {
    "defaults": {},
    "overrides": []
  },
  "transformations": [],
  "links": [],
  "repeatDirection": "h",
  "repeat": null,
  "maxPerRow": 4
}
```

### 2.2 Grid Position System (gridPos)

The dashboard uses a 24-column grid system:

| Property | Range | Description |
|----------|-------|-------------|
| `x` | 0-23 | Horizontal position (column) |
| `y` | 0-∞ | Vertical position (row units) |
| `w` | 1-24 | Width in columns |
| `h` | 1-∞ | Height in grid units (1 unit = 30px) |

**Common Panel Sizes:**
- Full width: `w: 24`
- Half width: `w: 12`
- Third width: `w: 8`
- Quarter width: `w: 6`
- Standard height: `h: 8` (240px)
- Compact: `h: 4` (120px)
- Tall: `h: 12` (360px)

### 2.3 Row Panels (Collapsible Sections)

```json
{
  "id": 100,
  "type": "row",
  "title": "Section Title",
  "collapsed": false,
  "gridPos": { "x": 0, "y": 0, "w": 24, "h": 1 },
  "panels": []
}
```

---

## 3. Visualization Types (Complete Reference)

### 3.1 Time Series Panel

**Type**: `"timeseries"`

**Best For**: Metrics over time, trends, monitoring data

```json
{
  "type": "timeseries",
  "options": {
    "tooltip": {
      "mode": "single",
      "sort": "none"
    },
    "legend": {
      "displayMode": "list",
      "placement": "bottom",
      "showLegend": true,
      "calcs": ["lastNotNull", "max", "min", "mean"]
    }
  },
  "fieldConfig": {
    "defaults": {
      "custom": {
        "drawStyle": "line",
        "lineInterpolation": "smooth",
        "barAlignment": 0,
        "lineWidth": 2,
        "fillOpacity": 10,
        "gradientMode": "opacity",
        "spanNulls": 3600000,
        "insertNulls": false,
        "showPoints": "auto",
        "pointSize": 5,
        "stacking": { "mode": "none", "group": "A" },
        "axisPlacement": "auto",
        "axisLabel": "",
        "axisColorMode": "text",
        "axisBorderShow": false,
        "scaleDistribution": { "type": "linear" },
        "axisCenteredZero": false,
        "hideFrom": { "tooltip": false, "viz": false, "legend": false },
        "thresholdsStyle": { "mode": "off" }
      },
      "color": { "mode": "palette-classic" },
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "value": null, "color": "green" },
          { "value": 80, "color": "red" }
        ]
      },
      "unit": "percent",
      "min": 0,
      "max": 100,
      "decimals": 2
    }
  }
}
```

**Draw Styles**: `"line"`, `"bars"`, `"points"`

**Line Interpolation**: `"linear"`, `"smooth"`, `"stepBefore"`, `"stepAfter"`

**Gradient Modes**: `"none"`, `"opacity"`, `"hue"`, `"scheme"`

**spanNulls Options**:
- `false` - Never connect across nulls
- `true` - Always connect (deprecated)
- `3600000` - Connect if gap ≤ 1 hour (milliseconds) ← **RECOMMENDED**

**Stacking Modes**: `"none"`, `"normal"`, `"percent"`

### 3.2 Stat Panel

**Type**: `"stat"`

**Best For**: Single values, KPIs, current status

```json
{
  "type": "stat",
  "options": {
    "reduceOptions": {
      "values": false,
      "calcs": ["lastNotNull"],
      "fields": ""
    },
    "orientation": "auto",
    "textMode": "auto",
    "wideLayout": true,
    "colorMode": "value",
    "graphMode": "area",
    "justifyMode": "auto",
    "showPercentChange": false,
    "percentChangeColorMode": "standard"
  },
  "fieldConfig": {
    "defaults": {
      "color": { "mode": "thresholds" },
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "value": null, "color": "red" },
          { "value": 50, "color": "yellow" },
          { "value": 80, "color": "green" }
        ]
      },
      "unit": "percent",
      "min": 0,
      "max": 100
    }
  }
}
```

**Text Modes**: `"auto"`, `"value"`, `"value_and_name"`, `"name"`, `"none"`

**Color Modes**: `"none"`, `"value"`, `"background"`, `"background_solid"`

**Graph Modes**: `"none"`, `"area"` (shows sparkline)

**Calculation Options** (calcs):
- `"lastNotNull"` - Last non-null value
- `"last"` - Last value (including null)
- `"first"` - First value
- `"mean"` - Average
- `"max"` - Maximum
- `"min"` - Minimum
- `"sum"` - Sum
- `"count"` - Count
- `"range"` - Max - Min
- `"delta"` - Cumulative change
- `"diff"` - Difference between first and last
- `"allIsNull"` - Boolean: all values null
- `"allIsZero"` - Boolean: all values zero

### 3.3 Gauge Panel

**Type**: `"gauge"`

**Best For**: Progress indicators, percentages, bounded values

```json
{
  "type": "gauge",
  "options": {
    "reduceOptions": {
      "values": false,
      "calcs": ["lastNotNull"],
      "fields": ""
    },
    "orientation": "auto",
    "showThresholdLabels": false,
    "showThresholdMarkers": true,
    "sizing": "auto",
    "minVizWidth": 75,
    "minVizHeight": 75
  },
  "fieldConfig": {
    "defaults": {
      "color": { "mode": "thresholds" },
      "thresholds": {
        "mode": "percentage",
        "steps": [
          { "value": null, "color": "green" },
          { "value": 70, "color": "yellow" },
          { "value": 90, "color": "red" }
        ]
      },
      "unit": "percent",
      "min": 0,
      "max": 100
    }
  }
}
```

**Threshold Modes**:
- `"absolute"` - Fixed values
- `"percentage"` - Percentage of min-max range

### 3.4 Bar Chart Panel

**Type**: `"barchart"`

**Best For**: Categorical data, comparisons, distributions

```json
{
  "type": "barchart",
  "options": {
    "orientation": "auto",
    "xTickLabelRotation": 0,
    "xTickLabelMaxLength": 0,
    "xTickLabelSpacing": 0,
    "showValue": "auto",
    "stacking": "none",
    "groupWidth": 0.7,
    "barWidth": 0.97,
    "barRadius": 0,
    "fullHighlight": false,
    "tooltip": { "mode": "single", "sort": "none" },
    "legend": {
      "displayMode": "list",
      "placement": "bottom",
      "showLegend": true
    }
  },
  "fieldConfig": {
    "defaults": {
      "custom": {
        "lineWidth": 1,
        "fillOpacity": 80,
        "gradientMode": "none",
        "axisPlacement": "auto",
        "axisLabel": "",
        "axisBorderShow": false
      },
      "color": { "mode": "palette-classic" },
      "thresholds": {
        "mode": "absolute",
        "steps": [{ "value": null, "color": "green" }]
      }
    }
  }
}
```

**Orientation**: `"auto"`, `"horizontal"`, `"vertical"`

**Stacking**: `"none"`, `"normal"`, `"percent"`

**Show Value**: `"auto"`, `"always"`, `"never"`

### 3.5 Pie Chart Panel

**Type**: `"piechart"`

**Best For**: Proportions, distributions, percentages

```json
{
  "type": "piechart",
  "options": {
    "reduceOptions": {
      "values": false,
      "calcs": ["lastNotNull"],
      "fields": ""
    },
    "pieType": "pie",
    "tooltip": { "mode": "single", "sort": "none" },
    "legend": {
      "displayMode": "list",
      "placement": "right",
      "showLegend": true,
      "values": ["percent", "value"]
    },
    "displayLabels": ["name", "percent"]
  },
  "fieldConfig": {
    "defaults": {
      "color": { "mode": "palette-classic" }
    }
  }
}
```

**Pie Types**: `"pie"`, `"donut"`

**Display Labels**: `"name"`, `"percent"`, `"value"`

**Legend Values**: `"percent"`, `"value"`

### 3.6 Table Panel

**Type**: `"table"`

**Best For**: Tabular data, lists, detailed records

```json
{
  "type": "table",
  "options": {
    "showHeader": true,
    "cellHeight": "sm",
    "footer": {
      "show": false,
      "reducer": ["sum"],
      "countRows": false,
      "fields": ""
    },
    "sortBy": []
  },
  "fieldConfig": {
    "defaults": {
      "custom": {
        "align": "auto",
        "cellOptions": { "type": "auto" },
        "inspect": false,
        "filterable": false,
        "minWidth": 50
      }
    },
    "overrides": [
      {
        "matcher": { "id": "byName", "options": "Status" },
        "properties": [
          {
            "id": "custom.cellOptions",
            "value": {
              "type": "color-background",
              "mode": "gradient"
            }
          }
        ]
      }
    ]
  }
}
```

**Cell Height**: `"sm"` (small), `"md"` (medium), `"lg"` (large)

**Cell Types**:
- `"auto"` - Automatic
- `"color-text"` - Colored text
- `"color-background"` - Colored background (with mode: `"basic"` or `"gradient"`)
- `"gauge"` - Inline gauge (with mode: `"basic"`, `"gradient"`, or `"lcd"`)
- `"sparkline"` - Inline sparkline chart
- `"json-view"` - JSON viewer
- `"data-links"` - Clickable links
- `"image"` - Image display

### 3.7 State Timeline Panel

**Type**: `"state-timeline"`

**Best For**: Status changes over time, state history

```json
{
  "type": "state-timeline",
  "options": {
    "showValue": "auto",
    "mergeValues": true,
    "alignValue": "left",
    "rowHeight": 0.9,
    "tooltip": { "mode": "single", "sort": "none" },
    "legend": { "displayMode": "list", "placement": "bottom", "showLegend": true }
  },
  "fieldConfig": {
    "defaults": {
      "custom": { "lineWidth": 0, "fillOpacity": 70, "spanNulls": false },
      "color": { "mode": "thresholds" },
      "mappings": [
        { "type": "value", "options": { "OK": { "color": "green", "index": 0 } } },
        { "type": "value", "options": { "WARNING": { "color": "yellow", "index": 1 } } },
        { "type": "value", "options": { "ERROR": { "color": "red", "index": 2 } } }
      ]
    }
  }
}
```

### 3.8 Heatmap Panel

**Type**: `"heatmap"`

**Best For**: Density visualizations, correlation matrices

```json
{
  "type": "heatmap",
  "options": {
    "calculate": false,
    "cellGap": 1,
    "cellRadius": 0,
    "color": {
      "mode": "scheme",
      "scheme": "Oranges",
      "steps": 64
    },
    "exemplars": { "color": "rgba(255,0,255,0.7)" },
    "filterValues": { "le": 1e-9 },
    "tooltip": { "show": true, "yHistogram": false },
    "legend": { "show": true },
    "yAxis": { "axisPlacement": "left", "reverse": false }
  }
}
```

### 3.9 Text/Markdown Panel

**Type**: `"text"`

**Best For**: Documentation, headers, instructions

```json
{
  "type": "text",
  "options": {
    "mode": "markdown",
    "content": "# Dashboard Title\n\nDescription text with **bold** and *italic*.",
    "code": { "language": "plaintext", "showLineNumbers": false, "showMiniMap": false }
  }
}
```

**Modes**: `"markdown"`, `"html"`, `"code"`

### 3.10 Alert List Panel

**Type**: `"alertlist"`

**Best For**: Showing active alerts

```json
{
  "type": "alertlist",
  "options": {
    "showOptions": "current",
    "maxItems": 10,
    "sortOrder": 1,
    "dashboardAlerts": false,
    "alertName": "",
    "dashboardTitle": "",
    "stateFilter": { "ok": false, "paused": false, "no_data": true, "execution_error": true, "alerting": true, "pending": true }
  }
}
```

### 3.11 Logs Panel

**Type**: `"logs"`

**Best For**: Log data display (Loki, Elasticsearch)

```json
{
  "type": "logs",
  "options": {
    "showTime": true,
    "showLabels": false,
    "showCommonLabels": false,
    "wrapLogMessage": false,
    "prettifyLogMessage": false,
    "enableLogDetails": true,
    "dedupStrategy": "none",
    "sortOrder": "Descending"
  }
}
```

### 3.12 News Panel

**Type**: `"news"`

**Best For**: RSS feeds

```json
{
  "type": "news",
  "options": {
    "feedUrl": "https://grafana.com/blog/news.xml",
    "showImage": true
  }
}
```

### 3.13 Geomap Panel

**Type**: `"geomap"`

**Best For**: Geographic data visualization

```json
{
  "type": "geomap",
  "options": {
    "view": {
      "id": "zero",
      "lat": 0,
      "lon": 0,
      "zoom": 1
    },
    "basemap": { "type": "default", "name": "Layer 0" },
    "layers": [],
    "tooltip": { "mode": "details" },
    "controls": {
      "showZoom": true,
      "showAttribution": true,
      "showScale": false,
      "showMeasure": false,
      "showDebug": false
    }
  }
}
```

---

## 4. Data Source Targets (Queries)

### 4.1 SQL Server (MSSQL) Query Structure

```json
{
  "targets": [
    {
      "refId": "A",
      "datasource": {
        "type": "mssql",
        "uid": "${datasource}"
      },
      "format": "time_series",
      "rawSql": "SELECT Timestamp AS time, Value AS value, SensorName AS metric FROM SensorData WHERE Timestamp BETWEEN $__timeFrom() AND $__timeTo() ORDER BY time ASC",
      "hide": false
    }
  ]
}
```

**Format Options**:
- `"time_series"` - For time series panels
- `"table"` - For table panels

### 4.2 Grafana MSSQL Macros

| Macro | Description | Example Output |
|-------|-------------|----------------|
| `$__timeFrom()` | Start of selected time range | `'2024-01-01T00:00:00Z'` |
| `$__timeTo()` | End of selected time range | `'2024-01-07T23:59:59Z'` |
| `$__timeGroup(column, interval)` | Group by time bucket | `DATEADD(s, DATEDIFF(...)/60*60, ...)` |
| `$__timeGroupAlias(column, interval, alias)` | Group with alias | Same as above with alias |
| `$__unixEpochFrom()` | Start as Unix timestamp | `1704067200` |
| `$__unixEpochTo()` | End as Unix timestamp | `1704672000` |
| `$__unixEpochNanoFrom()` | Start in nanoseconds | `1704067200000000000` |
| `$__unixEpochNanoTo()` | End in nanoseconds | `1704672000000000000` |
| `$__unixEpochGroup(column, interval)` | Group Unix epoch | Date grouping expression |

### 4.3 Time Series Query Pattern

```sql
-- CRITICAL: Column naming for time series
SELECT 
    Timestamp AS time,      -- Must be datetime, named 'time'
    Value AS value,         -- Numeric value
    Category AS metric      -- Optional: series name
FROM TableName
WHERE Timestamp BETWEEN $__timeFrom() AND $__timeTo()
ORDER BY time ASC           -- MUST be ascending for time series
```

### 4.4 Table Query Pattern

```sql
-- For table format
SELECT 
    Column1,
    Column2,
    Column3
FROM TableName
WHERE Timestamp BETWEEN $__timeFrom() AND $__timeTo()
ORDER BY Column1 DESC
```

### 4.5 Stat/Gauge Query Pattern

```sql
-- Single value
SELECT TOP 1 Value
FROM TableName
WHERE EquipID = $equipment
ORDER BY CreatedAt DESC
```

### 4.6 Using Variables in Queries

```sql
-- Variable reference syntax
SELECT * FROM TableName 
WHERE EquipID = $equipment           -- Single value
  AND Status IN ($status)            -- Multi-value
  AND Category = '${category}'       -- With quotes
  AND Name LIKE '%${search}%'        -- In patterns
```

---

## 5. Template Variables (Templating)

### 5.1 Variable Types

```json
{
  "templating": {
    "list": [
      {
        "name": "datasource",
        "type": "datasource",
        "query": "mssql",
        "current": {},
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "options": [],
        "refresh": 1
      },
      {
        "name": "equipment",
        "type": "query",
        "datasource": { "type": "mssql", "uid": "${datasource}" },
        "query": "SELECT EquipID AS __value, EquipName AS __text FROM Equipment ORDER BY EquipName",
        "current": {},
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "options": [],
        "refresh": 1,
        "regex": "",
        "sort": 1
      },
      {
        "name": "status",
        "type": "custom",
        "query": "Active,Inactive,Pending",
        "current": { "text": "Active", "value": "Active" },
        "hide": 0,
        "includeAll": true,
        "allValue": "*",
        "multi": true,
        "options": []
      },
      {
        "name": "interval",
        "type": "interval",
        "query": "1m,5m,10m,30m,1h,6h,12h,1d",
        "current": { "text": "1h", "value": "1h" },
        "hide": 0,
        "auto": true,
        "auto_min": "10s",
        "auto_count": 100
      },
      {
        "name": "constant",
        "type": "constant",
        "query": "fixed_value",
        "hide": 2
      },
      {
        "name": "textbox",
        "type": "textbox",
        "query": "default_text",
        "hide": 0
      }
    ]
  }
}
```

### 5.2 Variable Hide Options

| Value | Description |
|-------|-------------|
| `0` | Visible (label and dropdown) |
| `1` | Label only (no dropdown) |
| `2` | Hidden (variable only) |

### 5.3 Variable Refresh Options

| Value | Description |
|-------|-------------|
| `0` | Never |
| `1` | On dashboard load |
| `2` | On time range change |

### 5.4 Sort Options

| Value | Description |
|-------|-------------|
| `0` | Disabled |
| `1` | Alphabetical (asc) |
| `2` | Alphabetical (desc) |
| `3` | Numerical (asc) |
| `4` | Numerical (desc) |
| `5` | Alphabetical (case-insensitive, asc) |
| `6` | Alphabetical (case-insensitive, desc) |

### 5.5 Query Variable with __text and __value

```sql
-- Returns separate display text and internal value
SELECT 
    EquipID AS __value,      -- Internal value used in queries
    EquipName AS __text      -- Display text in dropdown
FROM Equipment
ORDER BY EquipName
```

---

## 6. Field Configuration (fieldConfig)

### 6.1 Complete fieldConfig Structure

```json
{
  "fieldConfig": {
    "defaults": {
      "unit": "percent",
      "min": 0,
      "max": 100,
      "decimals": 2,
      "displayName": "Custom Name",
      "noValue": "N/A",
      "color": {
        "mode": "thresholds"
      },
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "value": null, "color": "green" },
          { "value": 50, "color": "yellow" },
          { "value": 80, "color": "red" }
        ]
      },
      "mappings": [],
      "links": [],
      "custom": {}
    },
    "overrides": []
  }
}
```

### 6.2 Common Units

| Category | Units |
|----------|-------|
| **Misc** | `none`, `short`, `percent`, `percentunit`, `humidity`, `dB`, `bool`, `bool_yes_no`, `bool_on_off` |
| **Data** | `bytes`, `decbytes`, `bits`, `decbits`, `kbytes`, `mbytes`, `gbytes` |
| **Data Rate** | `Bps`, `KBs`, `MBs`, `GBs`, `pps` |
| **Time** | `ms`, `s`, `m`, `h`, `d`, `dtdurationms`, `dtdurationseconds` |
| **Date/Time** | `dateTimeAsIso`, `dateTimeAsIsoNoDateIfToday`, `dateTimeAsUS`, `dateTimeAsUSNoDateIfToday`, `dateTimeLocal`, `dateTimeFromNow` |
| **Currency** | `currencyUSD`, `currencyEUR`, `currencyGBP`, `currencyJPY` |
| **Energy** | `watt`, `kwatt`, `mwatt`, `watth`, `kwatth`, `joule` |
| **Temperature** | `celsius`, `fahrenheit`, `kelvin` |
| **Velocity** | `velocityms`, `velocitykmh`, `velocitymph`, `velocityknot` |
| **Volume** | `litre`, `mlitre`, `m3`, `gallon` |
| **Length** | `lengthmm`, `lengthm`, `lengthkm`, `lengthmi`, `lengthft` |
| **Area** | `areaM2`, `areaF2`, `areaAcre` |
| **Mass** | `massg`, `masskg`, `masst`, `masslb` |
| **Pressure** | `pressurembar`, `pressurebar`, `pressurekbar`, `pressurehpa`, `pressurekpa`, `pressurehg`, `pressurepsi` |

### 6.3 Value Mappings

```json
{
  "mappings": [
    {
      "type": "value",
      "options": {
        "0": { "text": "Offline", "color": "red", "index": 0 },
        "1": { "text": "Online", "color": "green", "index": 1 }
      }
    },
    {
      "type": "range",
      "options": {
        "from": 0,
        "to": 50,
        "result": { "text": "Low", "color": "blue", "index": 2 }
      }
    },
    {
      "type": "regex",
      "options": {
        "pattern": "error.*",
        "result": { "text": "Error!", "color": "red", "index": 3 }
      }
    },
    {
      "type": "special",
      "options": {
        "match": "null",
        "result": { "text": "No Data", "color": "gray", "index": 4 }
      }
    }
  ]
}
```

**Special Match Values**: `"null"`, `"nan"`, `"null+nan"`, `"true"`, `"false"`, `"empty"`

### 6.4 Field Overrides

```json
{
  "overrides": [
    {
      "matcher": { "id": "byName", "options": "Temperature" },
      "properties": [
        { "id": "unit", "value": "celsius" },
        { "id": "color", "value": { "mode": "fixed", "fixedColor": "orange" } }
      ]
    },
    {
      "matcher": { "id": "byRegexp", "options": "/.*_percent$/" },
      "properties": [
        { "id": "unit", "value": "percent" },
        { "id": "min", "value": 0 },
        { "id": "max", "value": 100 }
      ]
    },
    {
      "matcher": { "id": "byType", "options": "number" },
      "properties": [
        { "id": "decimals", "value": 2 }
      ]
    },
    {
      "matcher": { "id": "byFrameRefID", "options": "A" },
      "properties": [
        { "id": "displayName", "value": "Query A Results" }
      ]
    }
  ]
}
```

**Matcher Types**:
- `byName` - Exact field name match
- `byRegexp` - Regex pattern match
- `byType` - Field type (number, string, time, boolean)
- `byFrameRefID` - Query reference ID (A, B, C, etc.)
- `byValue` - Match by field value conditions

---

## 7. Data Transformations

### 7.1 Transformation Structure

```json
{
  "transformations": [
    {
      "id": "transformation_id",
      "options": {}
    }
  ]
}
```

### 7.2 Common Transformations

#### Filter by Name
```json
{
  "id": "filterFieldsByName",
  "options": {
    "include": { "names": ["time", "value", "metric"] },
    "byVariable": false
  }
}
```

#### Filter by Value
```json
{
  "id": "filterByValue",
  "options": {
    "type": "include",
    "match": "all",
    "filters": [
      {
        "fieldName": "Value",
        "config": { "id": "greater", "options": { "value": 0 } }
      }
    ]
  }
}
```

**Filter Conditions**: `"lower"`, `"greater"`, `"equal"`, `"notEqual"`, `"regex"`, `"isNull"`, `"isNotNull"`

#### Organize Fields
```json
{
  "id": "organize",
  "options": {
    "excludeByName": { "ID": true },
    "indexByName": { "time": 0, "value": 1, "metric": 2 },
    "renameByName": { "value": "Value", "metric": "Metric Name" }
  }
}
```

#### Join by Field (Outer)
```json
{
  "id": "joinByField",
  "options": {
    "byField": "time",
    "mode": "outer"
  }
}
```

**Modes**: `"outer"`, `"inner"`

#### Reduce
```json
{
  "id": "reduce",
  "options": {
    "reducers": ["mean", "max", "min", "last"],
    "mode": "reduceFields",
    "includeTimeField": false,
    "labelsToFields": false
  }
}
```

#### Group By
```json
{
  "id": "groupBy",
  "options": {
    "fields": {
      "Category": { "operation": "groupby", "aggregations": [] },
      "Value": { "operation": "aggregate", "aggregations": ["mean", "sum"] }
    }
  }
}
```

#### Add Field from Calculation
```json
{
  "id": "calculateField",
  "options": {
    "mode": "binary",
    "reduce": {
      "reducer": "sum"
    },
    "binary": {
      "left": "FieldA",
      "operator": "+",
      "right": "FieldB"
    },
    "alias": "Calculated"
  }
}
```

**Binary Operators**: `"+"`, `"-"`, `"*"`, `"/"`, `"%"`

#### Sort By
```json
{
  "id": "sortBy",
  "options": {
    "fields": {},
    "sort": [
      { "field": "value", "desc": true }
    ]
  }
}
```

#### Limit
```json
{
  "id": "limit",
  "options": {
    "limitField": 10
  }
}
```

#### Merge
```json
{
  "id": "merge",
  "options": {}
}
```

#### Concatenate Fields
```json
{
  "id": "concatenate",
  "options": {
    "frameNameMode": "field",
    "frameNameLabel": "frame"
  }
}
```

#### Rename by Regex
```json
{
  "id": "renameByRegex",
  "options": {
    "regex": "^prefix_(.*)$",
    "renamePattern": "$1"
  }
}
```

#### Convert Field Type
```json
{
  "id": "convertFieldType",
  "options": {
    "fields": {},
    "conversions": [
      { "targetField": "timestamp", "destinationType": "time" },
      { "targetField": "value", "destinationType": "number" }
    ]
  }
}
```

**Destination Types**: `"number"`, `"string"`, `"time"`, `"boolean"`, `"enum"`, `"other"`

#### Labels to Fields
```json
{
  "id": "labelsToFields",
  "options": {
    "mode": "columns",
    "valueLabel": ""
  }
}
```

#### Series to Rows
```json
{
  "id": "seriesToRows",
  "options": {}
}
```

#### Partition by Values
```json
{
  "id": "partitionByValues",
  "options": {
    "fields": ["Category"],
    "keepFields": false,
    "naming": { "asLabels": true }
  }
}
```

---

## 8. Annotations

### 8.1 Built-in Annotations

```json
{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": { "type": "grafana", "uid": "-- Grafana --" },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  }
}
```

### 8.2 Query-based Annotations

```json
{
  "annotations": {
    "list": [
      {
        "datasource": { "type": "mssql", "uid": "${datasource}" },
        "enable": true,
        "hide": false,
        "iconColor": "red",
        "name": "Anomaly Events",
        "rawQuery": true,
        "query": "SELECT StartTime AS time, 'Anomaly' AS text, 'Episode' AS title FROM ACM_Anomaly_Events WHERE EquipID = $equipment AND StartTime BETWEEN $__timeFrom() AND $__timeTo()"
      }
    ]
  }
}
```

---

## 9. Dashboard Links

### 9.1 Link Types

```json
{
  "links": [
    {
      "title": "Related Dashboard",
      "type": "link",
      "url": "/d/dashboard-uid/dashboard-title",
      "targetBlank": true,
      "icon": "external link",
      "tooltip": "Open related dashboard"
    },
    {
      "title": "Tag-based Dashboards",
      "type": "dashboards",
      "tags": ["monitoring"],
      "asDropdown": true,
      "includeVars": true,
      "keepTime": true
    }
  ]
}
```

### 9.2 Data Links (on Fields)

```json
{
  "fieldConfig": {
    "defaults": {
      "links": [
        {
          "title": "View Details",
          "url": "/d/detail-dashboard?var-id=${__value.raw}",
          "targetBlank": true
        },
        {
          "title": "External Link",
          "url": "https://example.com/item/${__data.fields.ID}",
          "targetBlank": true
        }
      ]
    }
  }
}
```

**Data Link Variables**:
- `${__value.raw}` - Raw field value
- `${__value.text}` - Formatted field value
- `${__value.numeric}` - Numeric value
- `${__value.time}` - Time value (epoch ms)
- `${__field.name}` - Field name
- `${__field.labels.labelName}` - Label value
- `${__data.fields.FieldName}` - Value from another field in same row
- `${__series.name}` - Series name

---

## 10. Color Schemes

### 10.1 Color Modes

```json
{
  "color": {
    "mode": "palette-classic"
  }
}
```

**Available Modes**:
- `"fixed"` - Single fixed color
- `"thresholds"` - Color based on thresholds
- `"palette-classic"` - Classic color palette
- `"palette-classic-by-name"` - Palette by series name
- `"continuous-GrYlRd"` - Green to Yellow to Red gradient
- `"continuous-RdYlGr"` - Red to Yellow to Green gradient
- `"continuous-BlYlRd"` - Blue to Yellow to Red gradient
- `"continuous-YlRd"` - Yellow to Red gradient
- `"continuous-BlPu"` - Blue to Purple gradient
- `"continuous-YlBl"` - Yellow to Blue gradient
- `"continuous-blues"` - Blues gradient
- `"continuous-reds"` - Reds gradient
- `"continuous-greens"` - Greens gradient
- `"continuous-purples"` - Purples gradient

### 10.2 Fixed Color

```json
{
  "color": {
    "mode": "fixed",
    "fixedColor": "#FF5733"
  }
}
```

**Named Colors**: `"green"`, `"yellow"`, `"red"`, `"blue"`, `"orange"`, `"purple"`, `"dark-green"`, `"dark-yellow"`, `"dark-red"`, `"dark-blue"`, `"dark-orange"`, `"dark-purple"`, `"light-green"`, `"light-yellow"`, `"light-red"`, `"light-blue"`, `"light-orange"`, `"light-purple"`, `"super-light-green"`, `"super-light-yellow"`, `"super-light-red"`, `"super-light-blue"`, `"super-light-orange"`, `"super-light-purple"`, `"white"`, `"gray"`, `"transparent"`

---

## 11. Common Patterns and Best Practices

### 11.1 Time Series Panel for MSSQL

```json
{
  "type": "timeseries",
  "title": "Sensor Values Over Time",
  "datasource": { "type": "mssql", "uid": "${datasource}" },
  "targets": [
    {
      "refId": "A",
      "rawSql": "SELECT Timestamp AS time, Value AS value, SensorName AS metric FROM SensorData WHERE EquipID = $equipment AND Timestamp BETWEEN $__timeFrom() AND $__timeTo() ORDER BY time ASC",
      "format": "time_series"
    }
  ],
  "fieldConfig": {
    "defaults": {
      "custom": {
        "drawStyle": "line",
        "lineInterpolation": "smooth",
        "lineWidth": 2,
        "fillOpacity": 10,
        "spanNulls": 3600000
      },
      "unit": "short"
    }
  }
}
```

### 11.2 Latest Value Stat Panel

```json
{
  "type": "stat",
  "title": "Current Health",
  "datasource": { "type": "mssql", "uid": "${datasource}" },
  "targets": [
    {
      "refId": "A",
      "rawSql": "SELECT TOP 1 HealthIndex AS value FROM ACM_HealthTimeline WHERE EquipID = $equipment ORDER BY Timestamp DESC",
      "format": "table"
    }
  ],
  "options": {
    "reduceOptions": { "calcs": ["lastNotNull"] },
    "colorMode": "background",
    "graphMode": "none"
  },
  "fieldConfig": {
    "defaults": {
      "unit": "percent",
      "min": 0,
      "max": 100,
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "value": null, "color": "red" },
          { "value": 50, "color": "yellow" },
          { "value": 80, "color": "green" }
        ]
      }
    }
  }
}
```

### 11.3 Multi-Series Bar Chart

```json
{
  "type": "barchart",
  "title": "Detector Scores by Type",
  "datasource": { "type": "mssql", "uid": "${datasource}" },
  "targets": [
    {
      "refId": "A",
      "rawSql": "SELECT DetectorType AS category, AVG(Score) AS avg_score FROM ACM_DetectorScores WHERE EquipID = $equipment GROUP BY DetectorType ORDER BY avg_score DESC",
      "format": "table"
    }
  ],
  "options": {
    "orientation": "horizontal",
    "showValue": "always",
    "barWidth": 0.8
  },
  "fieldConfig": {
    "defaults": {
      "color": { "mode": "palette-classic" }
    }
  }
}
```

### 11.4 Equipment Dropdown Variable

```json
{
  "name": "equipment",
  "type": "query",
  "datasource": { "type": "mssql", "uid": "${datasource}" },
  "definition": "SELECT EquipID AS __value, EquipCode + ' - ' + EquipName AS __text FROM Equipment WHERE Active = 1 ORDER BY EquipCode",
  "query": "SELECT EquipID AS __value, EquipCode + ' - ' + EquipName AS __text FROM Equipment WHERE Active = 1 ORDER BY EquipCode",
  "refresh": 1,
  "sort": 1,
  "includeAll": false,
  "multi": false,
  "hide": 0
}
```

### 11.5 Gauge with Thresholds

```json
{
  "type": "gauge",
  "title": "RUL (Hours)",
  "fieldConfig": {
    "defaults": {
      "unit": "h",
      "min": 0,
      "max": 1000,
      "thresholds": {
        "mode": "absolute",
        "steps": [
          { "value": null, "color": "red" },
          { "value": 100, "color": "orange" },
          { "value": 250, "color": "yellow" },
          { "value": 500, "color": "green" }
        ]
      }
    }
  },
  "options": {
    "showThresholdMarkers": true,
    "showThresholdLabels": true
  }
}
```

---

## 12. Troubleshooting Common Issues

### 12.1 UID Conflict on Import

**Problem**: `precondition failed: StorageError: invalid object`

**Solution**: Change UID and reset version:
```json
{
  "uid": "new-unique-uid",
  "version": 1
}
```

### 12.2 Time Series Not Rendering

**Checklist**:
1. Query returns `time` column as datetime (not VARCHAR)
2. Query includes `ORDER BY time ASC`
3. `format` is `"time_series"` in target
4. `spanNulls` set to numeric value (e.g., `3600000`) not boolean

### 12.3 Variables Not Populating

**Checklist**:
1. Datasource variable defined before dependent variables
2. Query returns `__value` and `__text` columns
3. `refresh` set to `1` (on load) or `2` (on time change)

### 12.4 Overrides Not Applying

**Checklist**:
1. Matcher uses exact field name as returned by query
2. Field override is in `fieldConfig.overrides` array
3. Property IDs match Grafana's internal names exactly

### 12.5 T-SQL Reserved Words as Aliases

**NEVER use these as aliases**:
- `End`, `Start`, `Date`, `Time`, `Order`, `Group`, `Count`, `RowCount`, `Index`

**Safe alternatives**:
- `EndTime`, `StartTime`, `DateValue`, `TimeValue`, `OrderNum`, `GroupName`, `TotalCount`, `TotalRows`, `IndexNum`

---

## 13. Quick Reference Tables

### 13.1 Panel Types Summary

| Type | Use Case | Required Fields |
|------|----------|-----------------|
| `timeseries` | Time-based metrics | `time` (datetime), `value` (number) |
| `stat` | Single KPI values | Any numeric field |
| `gauge` | Bounded metrics | Numeric with min/max |
| `barchart` | Categorical comparison | Category + value fields |
| `piechart` | Proportions | Labels + values |
| `table` | Tabular data | Any columns |
| `state-timeline` | Status over time | `time` + state field |
| `heatmap` | Density visualization | X, Y buckets + values |
| `text` | Documentation | Markdown/HTML content |
| `geomap` | Geographic data | Lat/lon coordinates |

### 13.2 Format Reference

| Format | Query Column Names | Panel Types |
|--------|-------------------|-------------|
| `time_series` | `time`, `value`, `metric` | timeseries, stat, gauge |
| `table` | Any column names | table, barchart, piechart |

### 13.3 Essential JSON Paths

| Setting | JSON Path |
|---------|-----------|
| Dashboard title | `.title` |
| Dashboard UID | `.uid` |
| Time range | `.time.from`, `.time.to` |
| Panel title | `.panels[n].title` |
| Panel position | `.panels[n].gridPos` |
| Query SQL | `.panels[n].targets[0].rawSql` |
| Thresholds | `.panels[n].fieldConfig.defaults.thresholds.steps` |
| Variables | `.templating.list` |
| Annotations | `.annotations.list` |

---

## 14. ACM-Specific Patterns

### 14.1 Health Timeline Query

```sql
SELECT 
    Timestamp AS time,
    HealthIndex AS value,
    HealthZone AS metric
FROM ACM_HealthTimeline
WHERE EquipID = $equipment
    AND Timestamp BETWEEN $__timeFrom() AND $__timeTo()
ORDER BY time ASC
```

### 14.2 RUL Display (Stat Panel)

```sql
SELECT TOP 1
    P50_Median AS value
FROM ACM_RUL
WHERE EquipID = $equipment
    AND P50_Median IS NOT NULL
ORDER BY CreatedAt DESC
```

### 14.3 Detector Scores (Time Series)

```sql
SELECT 
    Timestamp AS time,
    ar1_z AS 'AR1',
    pca_spe_z AS 'PCA-SPE',
    pca_t2_z AS 'PCA-T2',
    iforest_z AS 'IForest',
    gmm_z AS 'GMM',
    omr_z AS 'OMR',
    fused_z AS 'Fused'
FROM ACM_Scores_Wide
WHERE EquipID = $equipment
    AND Timestamp BETWEEN $__timeFrom() AND $__timeTo()
ORDER BY Timestamp ASC
```

### 14.4 Episode Count (Stat Panel)

```sql
SELECT COUNT(*) AS value
FROM ACM_Anomaly_Events
WHERE EquipID = $equipment
    AND StartTime BETWEEN $__timeFrom() AND $__timeTo()
```

### 14.5 Regime Distribution (Pie Chart)

```sql
SELECT 
    COALESCE(CAST(RegimeLabel AS VARCHAR), 'Unknown') AS metric,
    COUNT(*) AS value
FROM ACM_RegimeTimeline
WHERE EquipID = $equipment
    AND Timestamp BETWEEN $__timeFrom() AND $__timeTo()
GROUP BY RegimeLabel
ORDER BY value DESC
```

---

## 15. Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-01-17 | Initial comprehensive skill document |

---

## References

- [Grafana Documentation](https://grafana.com/docs/grafana/latest/)
- [Dashboard JSON Model](https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/view-dashboard-json-model/)
- [Visualizations Reference](https://grafana.com/docs/grafana/latest/panels-visualizations/visualizations/)
- [Data Transformations](https://grafana.com/docs/grafana/latest/panels-visualizations/query-transform-data/transform-data/)
- [Variables/Templating](https://grafana.com/docs/grafana/latest/dashboards/variables/)
