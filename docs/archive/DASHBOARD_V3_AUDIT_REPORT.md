# Dashboard V3 Audit & Correction Report

**Date:** December 5, 2025  
**Dashboard:** Asset Health Dashboard v3  
**Status:** CORRECTED & READY

---

## Issues Found & Fixed

### Critical Schema Mismatches (7 Issues)

| # | Panel | Old Query | Issue | Fix |
|---|-------|-----------|-------|-----|
| 1 | Current Health Score | `LatestHealthScore` | Column doesn't exist in V10 | Use `HealthIndex` |
| 2 | Health Score Timeline | `LatestHealthScore` | Column doesn't exist in V10 | Use `HealthIndex` |
| 3 | Top OMR Contributing Features | `ACM_OMRContributionsLong` | Table doesn't exist in V10 | Use `ACM_ContributionTimeline` with `DetectorType` |
| 4 | Health Forecast | `ACM_HealthForecast` + `ForecastValue` | Table/column mismatch in V10 | Use `ACM_HealthForecast_TS` + `ForecastHealth` |
| 5 | RUL Summary | `ACM_RUL` + `RUL_Confidence` | Table/column mismatch in V10 | Use `ACM_RUL_Summary` + `Confidence` |
| 6 | Failure Probability | `ACM_FailureForecast` + `FailureProbability` | Table/column mismatch in V10 | Use `ACM_FailureForecast_TS` + `FailureProb` |
| 7 | Model Drift Detection | `DriftScore` | Column doesn't exist in V10 | Use `DriftValue` |

### Validation Against V2 Dashboard
Reference V2 correctly uses:
- `SELECT HealthIndex FROM ACM_HealthTimeline` ✓ (properly formatted)
- No inverted color modes ✓
- Correct RUL table naming ✓

---

## Features Added

| # | Panel | Table | Purpose |
|---|-------|-------|---------|
| 1 | Maintenance Recommendations | `ACM_MaintenanceRecommendation` | Shows recommended maintenance windows and failure probability |
| 2 | Defect Analysis | `ACM_SensorDefects` | Displays sensor violations by detector type and severity |

---

## ACM Feature Coverage (v10 Schema)

| Feature | Status | Table Used | Panel |
|---------|--------|-----------|-------|
| Health Score Monitoring | ✓ FIXED | ACM_HealthTimeline | Current Health Score, Health Score Timeline |
| OMR Detector | ✓ WORKING | ACM_OMRTimeline | OMR Detector Score Timeline |
| Anomaly Detection | ✓ WORKING | ACM_SensorHotspots | Top Anomalous Sensors |
| Operating Regimes | ✓ WORKING | ACM_RegimeTimeline | Regime Occupancy, Regime Timeline |
| Episodes & Metrics | ✓ WORKING | ACM_EpisodeMetrics | Episode Statistics |
| Drift Detection | ✓ FIXED | ACM_DriftSeries | Model Drift Detection |
| Health Forecasting | ✓ FIXED | ACM_HealthForecast_TS | Health Forecast (7-Day) |
| Failure Probability | ✓ FIXED | ACM_FailureForecast_TS | Failure Probability Forecast |
| RUL Estimation | ✓ FIXED | ACM_RUL_Summary | Remaining Useful Life |
| Data Quality | ✓ WORKING | ACM_DataQuality | Data Quality Assessment |
| Detector Fusion | ✓ FIXED | ACM_ContributionTimeline | Top OMR Contributing, Detector Fusion Weights |
| Maintenance | ✓ NEW | ACM_MaintenanceRecommendation | Maintenance Recommendations |
| Defect Analysis | ✓ NEW | ACM_SensorDefects | Defect Analysis |

---

## Corrected Dashboard File

**Location:** `grafana_dashboards/asset_health_dashboard_v3_corrected.json`

**Total Panels:** 26 (24 original + 2 new)  
**All Queries:** V10 Schema Compliant  
**Status:** Ready for Grafana Import

---

## Lessons Learned & Recommendations

### Root Cause
- Dashboard was created against outdated/assumed schema without verifying V10 actual table/column names
- V2 dashboard was available but not consulted for query patterns

### Prevention Strategy
1. **Always reference current schema:** Run `python scripts/sql/export_schema_doc.py` before dashboard creation
2. **Use version control:** Check V2 as golden reference for query patterns
3. **Validate early:** Test sample queries against live DB before building full dashboard
4. **Document schema:** Keep `docs/sql/SQL_SCHEMA_REFERENCE.md` updated with each release

### V10 Schema Key Tables
- `ACM_HealthTimeline` - Use `HealthIndex` (not LatestHealthScore)
- `ACM_HealthForecast_TS` - Use `ForecastHealth` (not ForecastValue)
- `ACM_FailureForecast_TS` - Use `FailureProb` (not FailureProbability)
- `ACM_RUL_Summary` - Use `Confidence` (not RUL_Confidence)
- `ACM_DriftSeries` - Use `DriftValue` (not DriftScore)
- `ACM_ContributionTimeline` - Use `DetectorType` (not SensorName)

---

## Import Instructions

1. Open Grafana at `http://localhost:3000`
2. Navigate to **Dashboards** → **Import**
3. Paste content of `asset_health_dashboard_v3_corrected.json`
4. Select MSSQL datasource: `mssql_acm`
5. Click **Import**
6. Test panels by selecting equipment from dropdown

---

**Generated by:** Copilot Dashboard Audit Tool  
**Schema Reference:** `docs/sql/SQL_SCHEMA_REFERENCE.md` (updated)  
**V2 Reference:** `grafana_dashboards/asset_health_dashboard_v2.json`
